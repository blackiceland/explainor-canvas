================================================================================
DAEDALUS — Video Factory System (production)
================================================================================

Назначение: ускорить производство сцен и снизить цену итераций.

DAEDALUS = 2 контура:
  1) RAG → “что правильно” (правила/рецепты/токены)
  2) STILL → “что реально на экране” (PNG кадр для проверки композиции)

Если нет STILL — мы угадываем и жжём токены.

См. также:
  - DESIGN_SYSTEM.txt (философия и принципы)
  - COOKBOOK.txt (готовые примеры)

================================================================================
ГДЕ ЧТО ЛЕЖИТ
================================================================================

- src/core/layouts/       → getSlots() пресеты
- src/core/beats/         → переиспользуемые анимации
- src/core/theme.ts       → Colors/Fonts/Timing/Screen
- src/core/ScreenGrid.ts  → SafeZone
- db/seed.sql             → знания для RAG (single source of truth)
- scripts/                → утилиты (DB/embeddings/query/still)

================================================================================
ПРАВИЛА ДЛЯ СЦЕН (МИНИМУМ)
================================================================================

1) Никаких “магических” чисел:
   - тайминги только Timing.*
   - цвета только Colors/OpenStyle/PanelStyle (кроме rgba(0,0,0,0))

2) Никаких ручных координат:
   - позиционирование через getSlots()
   - выравнивание/отступы делай внутри слота (layout/padding)

3) Любой спор про композицию → делаем STILL и меряем на PNG.

================================================================================
RAG: БЫСТРЫЕ ЗАПРОСЫ (CLI)
================================================================================

Скрипт: scripts/query-rag.ts

Запуск:
  cd scripts
  npm run query-rag -- "your query" [options]

Примеры:
  npm run query-rag -- "safe zone" --category rule
  npm run query-rag -- "layout 2L-2R padding symmetry"
  npm run query-rag -- "scan animation tables" --category rule
  npm run query-rag -- "code comparison scene" --category example

Важно:
  - По умолчанию используем БД (если поднята).
  - --mock включает mock-эмбеддинги (детерминированные) → выдача не “прыгает”.

================================================================================
STILL: АВТО-ЭКСПОРТ PNG (ЧТОБЫ AI ВИДЕЛ КОМПОЗИЦИЮ)
================================================================================

Зачем: получить PNG прямо в репозитории, без ручного экспорта из UI.
Вывод: motion-canvas/output/still/<project>/<frame>.png

One-time setup:
  cd scripts
  npm install
  npx playwright install chromium

Важно:
  - Скрипт STILL НЕ должен вмешиваться в dev server.
  - Сначала запускаешь dev server сам (в отдельном терминале), затем делаешь still.

Рендер кадра сцены:
  cd motion-canvas
  npm run dev
  # отдельный терминал:
  cd scripts
  npm run still -- --scene dryFiltersSceneV3 --frame 0

Опции:
  --frames <csv>    несколько кадров за один запуск, например: 0,60,120,180
  --frame <n>       frame внутри сцены (local scene frame)
  --globalFrame <n> frame на общей таймлинии проекта (если нужно)
  --fps <n>         default 60
  --port <n>        default 5173 (порт УЖЕ запущенного dev server)
  --timeoutMs <n>   default 120000

Заметка:
  frame=0 часто пустой (ещё до appear/отрисовки). Используй:
    - --frame 120 (примерно 2 секунды при 60fps)
    - или --frames 0,60,120,180 и выбери правильный PNG

================================================================================
UI GRID (РЕДАКТОР MOTION CANVAS)
================================================================================

По умолчанию включена тонкая сетка + координаты по краям на КАЖДЫЙ шаг (minorStep).
Горячие клавиши:
  - G: показать/скрыть сетку
  - C: показать/скрыть подписи координат в каждой клетке (по умолчанию выключено, шумно)

================================================================================
КОМАНДЫ (DAEDALUS TOOLING)
================================================================================

cd scripts
npm run daedalus:up      # start DB + healthcheck + mock embeddings
npm run healthcheck      # verify DB state
npm run embeddings       # real embeddings (needs OPENAI_API_KEY)
npm run embeddings:mock  # deterministic mock embeddings (local dev)
npm run init-db          # re-apply schema+seed
npm run query-rag -- "..." [options]
npm run still -- --scene <SceneName> --frame <n>

================================================================================
КАК ПОПОЛНЯТЬ ФАБРИКУ (КОРОТКО)
================================================================================

Если ты решил повторяемую проблему (layout/симметрия/scan-rhythm):
  - добавь короткий рецепт в db/seed.sql (knowledge: rule/example)
  - прогони embeddings (real или mock)


